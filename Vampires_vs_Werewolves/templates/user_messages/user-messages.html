{% extends 'common/index.html' %}
{% block content %}

    <div class="messages-wrapper">

        <div class="all-messages">
            <span><a href="{% url 'messages' %}">Back to Messages</a></span>
            <div class="messages scrollable">
                <div class="message received">
                    <form method="POST">
                        <!-- Form for SendMessage -->
                        {{ form }}
                        {% csrf_token %}
                        <!-- Button to Send Message -->
                        <button type="submit" class="register">Reply</button>
                    </form>
                </div>
                {% for message in messages %}
                    <div class="message {% if message.sender == current_user %} received {% else %} sent {% endif %}">
                        <p>
                            {% if message.sender == current_user %}
                                To: <a href="{% url 'details user' message.recipient.username %}">
                                        {{ message.recipient }}
                                    </a>
                            {% else %}
                                From: <a href="{% url 'details user' message.sender.username %}">
                                        {{ message.sender }}
                                    </a>
                            {% endif %}
                        </p>
                        <p class="message-content">{{ message.content }}</p>
                        <time>{{ message.timestamp }}</time>
                    </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <script>
        window.addEventListener("load", function() {
          var container = document.getElementById("scrollable");
          container.scrollTop = container.scrollHeight;
        });

    </script>

{% endblock %}